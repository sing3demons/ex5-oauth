# SSO Flow Diagrams

## 1. First Login Flow (No SSO Session)

```
â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚         â”‚ App A â”‚         â”‚ OAuth Server â”‚         â”‚ Database â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 1. Click Login  â”‚                    â”‚                      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 2. Redirect to     â”‚                      â”‚
   â”‚                 â”‚    /oauth/authorizeâ”‚                      â”‚
   â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚ 3. Check SSO Cookie  â”‚
   â”‚                 â”‚                    â”‚    (Not Found)       â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 4. Redirect to     â”‚                      â”‚
   â”‚                 â”‚    /auth/login     â”‚                      â”‚
   â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 5. Show Login   â”‚                    â”‚                      â”‚
   â”‚    Form         â”‚                    â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 6. Enter        â”‚                    â”‚                      â”‚
   â”‚    Credentials  â”‚                    â”‚                      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 7. POST /auth/loginâ”‚                      â”‚
   â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚ 8. Validate User     â”‚
   â”‚                 â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚ 9. Create SSO Sessionâ”‚
   â”‚                 â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 10. Set SSO Cookie â”‚                      â”‚
   â”‚                 â”‚     + Show Consent â”‚                      â”‚
   â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 11. Show        â”‚                    â”‚                      â”‚
   â”‚     Consent     â”‚                    â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 12. Approve     â”‚                    â”‚                      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 13. POST /oauth/   â”‚                      â”‚
   â”‚                 â”‚     consent        â”‚                      â”‚
   â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚ 14. Save Consent     â”‚
   â”‚                 â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚ 15. Create Auth Code â”‚
   â”‚                 â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 16. Redirect with  â”‚                      â”‚
   â”‚                 â”‚     code           â”‚                      â”‚
   â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 17. Redirect    â”‚                    â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 18. Exchange code  â”‚                      â”‚
   â”‚                 â”‚     for tokens     â”‚                      â”‚
   â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 19. Logged in!  â”‚                    â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                      â”‚
```

## 2. Subsequent Login Flow (SSO Session Exists + Consent Given)

```
â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚         â”‚ App B â”‚         â”‚ OAuth Server â”‚         â”‚ Database â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 1. Click Login  â”‚                    â”‚                      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 2. Redirect to     â”‚                      â”‚
   â”‚                 â”‚    /oauth/authorizeâ”‚                      â”‚
   â”‚                 â”‚    (with SSO cookie)â”‚                     â”‚
   â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚ 3. Check SSO Cookie  â”‚
   â”‚                 â”‚                    â”‚    (Found & Valid!)  â”‚
   â”‚                 â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚ 4. Check Consent     â”‚
   â”‚                 â”‚                    â”‚    (Already Given!)  â”‚
   â”‚                 â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚ 5. Create Auth Code  â”‚
   â”‚                 â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 6. Redirect with   â”‚                      â”‚
   â”‚                 â”‚    code (instant!) â”‚                      â”‚
   â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 7. Redirect     â”‚                    â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 8. Exchange code   â”‚                      â”‚
   â”‚                 â”‚    for tokens      â”‚                      â”‚
   â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 9. Logged in!   â”‚                    â”‚                      â”‚
   â”‚    (No login    â”‚                    â”‚                      â”‚
   â”‚     screen!)    â”‚                    â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                      â”‚
```

## 3. SSO with New Consent Required

```
â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚         â”‚ App C â”‚         â”‚ OAuth Server â”‚         â”‚ Database â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 1. Click Login  â”‚                    â”‚                      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 2. Redirect to     â”‚                      â”‚
   â”‚                 â”‚    /oauth/authorizeâ”‚                      â”‚
   â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚ 3. Check SSO Cookie  â”‚
   â”‚                 â”‚                    â”‚    (Found & Valid!)  â”‚
   â”‚                 â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚ 4. Check Consent     â”‚
   â”‚                 â”‚                    â”‚    (Not Given Yet)   â”‚
   â”‚                 â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 5. Show Consent    â”‚                      â”‚
   â”‚                 â”‚    (Skip Login!)   â”‚                      â”‚
   â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 6. Show Consent â”‚                    â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 7. Approve      â”‚                    â”‚                      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 8. POST consent    â”‚                      â”‚
   â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚ 9. Save Consent      â”‚
   â”‚                 â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚ 10. Create Auth Code â”‚
   â”‚                 â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 11. Redirect       â”‚                      â”‚
   â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 12. Logged in!  â”‚                    â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                      â”‚
```

## 4. Logout Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚         â”‚ App A â”‚         â”‚ OAuth Server â”‚         â”‚ Database â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 1. Click Logout â”‚                    â”‚                      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 2. Redirect to     â”‚                      â”‚
   â”‚                 â”‚    /auth/logout    â”‚                      â”‚
   â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚ 3. Get SSO Session   â”‚
   â”‚                 â”‚                    â”‚    from Cookie       â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚ 4. Delete SSO Sessionâ”‚
   â”‚                 â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚                 â”‚ 5. Clear Cookie    â”‚                      â”‚
   â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ 6. Logged out   â”‚                    â”‚                      â”‚
   â”‚    from ALL appsâ”‚                    â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                      â”‚
   â”‚                 â”‚                    â”‚                      â”‚
   â”‚ Now if user tries to access App B or App C:                â”‚
   â”‚ They will need to login again!                             â”‚
```

## 5. Session Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚         â”‚ OAuth Server â”‚         â”‚ Database â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚                    â”‚                      â”‚
   â”‚ 1. GET /account/   â”‚                      â”‚
   â”‚    sessions        â”‚                      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                    â”‚                      â”‚
   â”‚                    â”‚ 2. Get User's        â”‚
   â”‚                    â”‚    Active Sessions   â”‚
   â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                    â”‚                      â”‚
   â”‚ 3. Show Sessions:  â”‚                      â”‚
   â”‚    - Chrome (Mac)  â”‚                      â”‚
   â”‚    - Safari (iPhone)â”‚                     â”‚
   â”‚    - Firefox (Win) â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                    â”‚                      â”‚
   â”‚ 4. DELETE /account/â”‚                      â”‚
   â”‚    sessions/xxx    â”‚                      â”‚
   â”‚    (Revoke iPhone) â”‚                      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                    â”‚                      â”‚
   â”‚                    â”‚ 5. Delete Session    â”‚
   â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                    â”‚                      â”‚
   â”‚ 6. Session Revoked â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                    â”‚                      â”‚
   â”‚ Now iPhone will need to login again       â”‚
```

## 6. Consent Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚         â”‚ OAuth Server â”‚         â”‚ Database â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚                    â”‚                      â”‚
   â”‚ 1. GET /account/   â”‚                      â”‚
   â”‚    authorizations  â”‚                      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                    â”‚                      â”‚
   â”‚                    â”‚ 2. Get User's        â”‚
   â”‚                    â”‚    Consents          â”‚
   â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                    â”‚                      â”‚
   â”‚ 3. Show Apps:      â”‚                      â”‚
   â”‚    - App A         â”‚                      â”‚
   â”‚      (profile,email)â”‚                     â”‚
   â”‚    - App B         â”‚                      â”‚
   â”‚      (openid only) â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                    â”‚                      â”‚
   â”‚ 4. DELETE /account/â”‚                      â”‚
   â”‚    authorizations/ â”‚                      â”‚
   â”‚    app-b           â”‚                      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                    â”‚                      â”‚
   â”‚                    â”‚ 5. Delete Consent    â”‚
   â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                    â”‚                      â”‚
   â”‚ 6. Consent Revoked â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                    â”‚                      â”‚
   â”‚ Next time App B tries to access:          â”‚
   â”‚ User will see consent screen again        â”‚
```

## 7. Security: Session Hijacking Detection

```
â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚         â”‚ OAuth Server â”‚         â”‚ Database â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚                    â”‚                      â”‚
   â”‚ Normal Request     â”‚                      â”‚
   â”‚ IP: 1.2.3.4        â”‚                      â”‚
   â”‚ UA: Chrome/Mac     â”‚                      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                    â”‚                      â”‚
   â”‚                    â”‚ Check Session        â”‚
   â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                    â”‚ Stored:              â”‚
   â”‚                    â”‚ IP: 1.2.3.4          â”‚
   â”‚                    â”‚ UA: Chrome/Mac       â”‚
   â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                    â”‚                      â”‚
   â”‚ âœ… Match! Allow    â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                    â”‚                      â”‚
   â”‚ Suspicious Request â”‚                      â”‚
   â”‚ IP: 9.8.7.6        â”‚                      â”‚
   â”‚ UA: Firefox/Win    â”‚                      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                    â”‚                      â”‚
   â”‚                    â”‚ Check Session        â”‚
   â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                    â”‚ Stored:              â”‚
   â”‚                    â”‚ IP: 1.2.3.4          â”‚
   â”‚                    â”‚ UA: Chrome/Mac       â”‚
   â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                    â”‚                      â”‚
   â”‚                    â”‚ âŒ Mismatch!         â”‚
   â”‚                    â”‚ Delete Session       â”‚
   â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                    â”‚                      â”‚
   â”‚ âš ï¸ Session Invalid â”‚                      â”‚
   â”‚ Please login again â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
```

## Key Differences: With vs Without SSO

### Without SSO (Current)
```
App A Login â†’ User enters credentials â†’ App A works
App B Login â†’ User enters credentials AGAIN â†’ App B works
App C Login â†’ User enters credentials AGAIN â†’ App C works

Total logins: 3 times ðŸ˜«
```

### With SSO (Proposed)
```
App A Login â†’ User enters credentials â†’ App A works
App B Login â†’ Auto-approved (instant!) â†’ App B works
App C Login â†’ Auto-approved (instant!) â†’ App C works

Total logins: 1 time ðŸŽ‰
```

## Cookie Scope Visualization

```
Domain: auth.example.com
Path: /
Secure: true
HttpOnly: true
SameSite: Lax

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         auth.example.com                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     SSO Cookie Scope              â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚  /oauth/authorize  âœ…             â”‚  â”‚
â”‚  â”‚  /auth/login       âœ…             â”‚  â”‚
â”‚  â”‚  /auth/logout      âœ…             â”‚  â”‚
â”‚  â”‚  /oauth/consent    âœ…             â”‚  â”‚
â”‚  â”‚  /account/*        âœ…             â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

app-a.example.com  âŒ (Different domain - no cookie)
app-b.example.com  âŒ (Different domain - no cookie)

But they redirect to auth.example.com which HAS the cookie!
```
